# 队列(Queue)

先进先出

```
n
head
tail

> tail++
< head++

tail = n // full
tail = head // empty
```

## 冗余空间

每次入队判断是否冗余，数据搬移回位置 0，head=0，tail-=head

## 循环队列

```
(tail+1)%n=head

> tail = (tail+1)%n
< head = (head+1)%n

(tail+1)%n=head // full
head=tail // empty
```

## 阻塞队列

队列为空，出队阻塞
队列已满，入队阻塞

### 生产者-消费者模型

生产者过快，队满，生产者被阻塞
生产者过快，队满，生产者被阻塞

配置多个消费者，应对一个生产者，提高效率

## 并发队列

线程安全的队列，多个线程同时操作队列，线程安全问题

### 加锁

锁粒度大，并发低，同一时刻只允许一个 存 或 取 操作

基于数组的循环队列，利用 CAS 原子操作，可以实现高效的并发队列，循环队列比链式队列应用广泛

## 线程池没有空闲线程时，新的任务请求线程资源，线程池如何处理？处理策略如何实现？

### 非阻塞处理

直接拒绝请求

### 阻塞处理

排队，空闲时出队

#### 链表

无限排队的无界队列

排队过多，请求处理的响应时间长，不适合响应时间敏感的系统

#### 数组

有界队列

超过队列大小，请求被拒绝

合理的队列大小，太大导致等待请求太多，太小无法充分利用系统资源、发挥最大性能

## 有限资源池

数据库连接池等，大部分资源有限的场景，没有空闲资源时，都可以用队列实现请求排队
